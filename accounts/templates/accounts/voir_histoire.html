{% extends "accounts/base.html" %}
{% block titre %}{{ histoire.titre }}{% endblock %}

{% block contenu %}
<div class="space-y-4">
  <div class="bg-white border rounded-3xl p-6 shadow-sm">
    <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">{{ histoire.titre }}</h1>
    <p class="mt-1 text-sm text-slate-600">Créée le {{ histoire.date_creation }}</p>

    <div class="mt-4 flex flex-wrap items-center gap-2">
      <span class="text-sm font-semibold text-slate-700">Langue :</span>

      <a class="px-3 py-2 rounded-xl text-sm border hover:bg-slate-50 {% if langue == 'fr' %}bg-gradient-to-r from-fuchsia-600 to-indigo-600 text-white border-transparent{% endif %}"
         href="?langue=fr">FR</a>
      <a class="px-3 py-2 rounded-xl text-sm border hover:bg-slate-50 {% if langue == 'en' %}bg-gradient-to-r from-fuchsia-600 to-indigo-600 text-white border-transparent{% endif %}"
         href="?langue=en">EN</a>
      <a class="px-3 py-2 rounded-xl text-sm border hover:bg-slate-50 {% if langue == 'es' %}bg-gradient-to-r from-fuchsia-600 to-indigo-600 text-white border-transparent{% endif %}"
         href="?langue=es">ES</a>
      <a class="px-3 py-2 rounded-xl text-sm border hover:bg-slate-50 {% if langue == 'ar' %}bg-gradient-to-r from-fuchsia-600 to-indigo-600 text-white border-transparent{% endif %}"
         href="?langue=ar">AR</a>
    </div>
  </div>

  <div class="space-y-4">
    {% for chapitre in chapitres %}
      <div class="bg-white border rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-bold">Chapitre {{ chapitre.numero }} — {{ chapitre.titre }}</h2>

        <p class="mt-3 leading-relaxed text-slate-800">{{ chapitre.texte }}</p>

        {% if chapitre.image_base64 %}
          <img src="{{ chapitre.image_base64 }}"
               alt="Illustration"
               class="mt-4 w-full max-w-md rounded-3xl border shadow-sm"
               loading="lazy">
        {% endif %}

        <div class="mt-4">
          <audio controls class="w-full">
            <source src="{% url 'audio_chapitre' chapitre.id %}?langue={{ langue }}" type="audio/mpeg">
          </audio>
          <p class="mt-2 text-xs text-slate-500">
            Astuce : si tu changes la langue, l’audio se regénère automatiquement.
          </p>
        </div>
      </div>
    {% endfor %}
  </div>

  {% if histoire.morale %}
    <div class="rounded-3xl p-6 bg-gradient-to-br from-indigo-50 to-fuchsia-50 border border-indigo-100 shadow-sm">
      <h2 class="text-lg font-extrabold text-indigo-900">Morale</h2>
      <p class="mt-2 text-slate-800 leading-relaxed">{{ histoire.morale }}</p>
    </div>
  {% endif %}

  <div>
    <a href="{% url 'dashboard' %}" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl border bg-white hover:bg-slate-50">
      ← Retour
    </a>
  </div>
</div>
{% endblock %}
